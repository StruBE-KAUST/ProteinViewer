<!DOCTYPE html>
<html>
  <head>
    <title>VR Molecules!</title>
    <meta name="description" content="View your molecule in Virtual Reality!">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
    <script src="https://rawgit.com/sparksia/aframe-physics-system/master/dist/aframe-physics-system.js"></script>
    <script src="https://rawgit.com/sparksia/aframe-extras/master/dist/aframe-extras.js"></script>
    <script src="../../static/js/aframe-physics-collider.js"></script>
    <script src="../../static/js/aframe-physics-collision-filter.js"></script>
    <script src="../../static/js/stuck.js"></script>s
    <script src="../../static/js/grab.js"></script>
    <script src="../../static/js/react.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="../../static/js/event-state.js"></script>
    <script src="../../static/js/cookie.js"></script>
    <script src="../../static/js/send-new-pos.js"></script>
    <script src="../../static/js/relative-position.js"></script>
    <script>
      // set the position of each domain using vectors from renderRelative.py
      $(function(){
        getRelativePos();

        // var sceneEl = document.querySelector('a-scene');
        // var entityEl = document.createElement('a-entity');
        // entityEl.setAttribute('after-load', '');
        // sceneEl.appendChild(entityEl);
        // console.log(sceneEl);
      });
    </script>
    <!-- <script>
      AFRAME.registerComponent('after-load', {
        init: function () {
          this.el.setAttribute("id", "testMol");
          this.el.setAttribute("class", "model");
          this.el.setAttribute("obj-model", {obj : '#model2', mtl : '#mat2'});
          this.el.setAttribute("scale", 100);
          this.el.flushToDOM();
          console.log(this.el);
        }
      });
    </script> -->
  </head>

  <body>

  <!-- TODO: Make it possible to write # of assets and molecules arbitrarily!! then use the positions and objects etc to load the objects..? (for the first time), after that just update using jQuery. -->

  <a-scene id="scene" physics="debug: true; gravity: 0" stats debug>
  <!-- creates assets for the .obj file and matching .mtl -->
    <a-assets>
      <a-mixin id = "controller" action event-state></a-mixin>
      <a-mixin id = "controller-loaded" 
                 static-body="shape: sphere; sphereRadius: 0.05;" 
                 physics-collider
                 collision-filter = "group: green; collidesWith: default, red, green;"
                 >
      </a-mixin>

      <a-mixin id="cube" stuck geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" dynamic-body="shape: hull; linearDamping: 0.99; angularDamping: 0.99" collision-filter="group: red; collidesWith: default, red, green"></a-mixin>

      <a-mixin id="cube-collided" material="opacity: 0.7; transparent: true"></a-mixin>


      <!-- Since we want to have a better mesh and the hull & mesh don't work properly -->
      <a-mixin id="molecule" stuck dynamic-body="shape: box; linearDamping: 0.99; angularDamping: 0.99"></a-mixin>

      <!-- {% load static %}
      <a-asset-item id="model" src="{% get_media_prefix %}models/{{ obj_file }}"></a-asset-item>
      <a-asset-item id="mat" src="{% get_media_prefix %}models/{{ mtl_file }}"></a-asset-item> -->

      {% load static %}
      <a-asset-item id="model0" src="{% get_media_prefix %}models/01_fk.obj"></a-asset-item>
      <a-asset-item id="mat0" src="{% get_media_prefix %}models/01_fk.mtl"></a-asset-item>
      <a-asset-item id="model1" src="{% get_media_prefix %}models/02_cit.obj"></a-asset-item>
      <a-asset-item id="mat1" src="{% get_media_prefix %}models/02_cit.mtl"></a-asset-item>
      <a-asset-item id="model2" src="{% get_media_prefix %}models/input_fk_Cit.obj"></a-asset-item>
      <a-asset-item id="mat2" src="{% get_media_prefix %}models/input_fk_Cit.mtl"></a-asset-item>
      <a-asset-item id="model3" src="{% get_media_prefix %}models/pdb.obj"></a-asset-item>
      <a-asset-item id="mat3" src="{% get_media_prefix %}models/pdb.mtl"></a-asset-item>
      <!-- <a-asset-item id="model3" src="{% get_media_prefix %}models/01_and_02.obj"></a-asset-item> -->
      <!-- <a-asset-item id="mat3" src="{% get_media_prefix %}models/01_and_02.mtl"></a-asset-item> -->


      <!-- <a-asset-item id="model1" src="../../static/models/VMD/ribbon-test1-reduced.obj"></a-asset-item>
      <a-asset-item id="mat1" src="../../static/models/VMD/ribbon-test1-reduced.obj.mtl"></a-asset-item>
      <a-asset-item id="model2" src="../../static/models/VMD/ribbon-test2-reduced.obj"></a-asset-item>
      <a-asset-item id="mat2" src="../../static/models/VMD/ribbon-test2-reduced.obj.mtl"></a-asset-item> 
      <a-asset-item id="model3" src="../../static/models/VMD/surface-test1-reduced.obj"></a-asset-item>
      <a-asset-item id="mat3" src="../../static/models/VMD/surface-test1-reduced.obj.mtl"></a-asset-item>
      <a-asset-item id="model4" src="../../static/models/VMD/surface-test2-reduced.obj"></a-asset-item>
      <a-asset-item id="mat4" src="../../static/models/VMD/surface-test2-reduced.obj.mtl"></a-asset-item>
    

      <a-asset-item id="hulldae" src="../../static/models/VMD/ribbon-test1-hull.dae"></a-asset-item>
      <a-asset-item id="hulldae2" src="../../static/models/VMD/ribbon-test2-hull.dae"></a-asset-item> -->
    </a-assets>

    <!-- HTC Vive controllers! -->

    <!-- TODO: SOMETHING WRONG WITH THE RAYCASTERS (suddenly stopped working?) -->

    <a-entity class="cont" id="one" mixin="controller" vive-controls="hand: left">
      <!-- <a-entity class="ray" id="1" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" raycaster="objects: .model" material="opacity: 0; transparent: true" rotation="0 180 0" react></a-entity>
      <a-entity class="ray" id="2" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" raycaster="objects: .model" material="opacity: 0; transparent: true" rotation="0 0 0" react></a-entity> -->
    </a-entity>
    <a-entity class="cont" id="two" mixin="controller" vive-controls="hand: right">
      <!-- <a-entity class="ray" id="1" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" raycaster="objects: .model" material="opacity: 0; transparent: true" rotation="0 180 0" react></a-entity>
      <a-entity class="ray" id="2" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" raycaster="objects: .model" material="opacity: 0; transparent: true" rotation="0 0 0" react></a-entity> -->
    </a-entity>

    <!-- loads the protein models -->

    <a-entity id="mol0" class="model" obj-model="obj: #model0; mtl: #mat0"></a-entity>
    <a-entity id="mol1" class="model" obj-model="obj: #model1; mtl: #mat1"></a-entity>
    <a-box color="red" depth="1" height="1" width="1"></a-box>
    <!-- <a-entity id="mol2" class="model" obj-model="obj: #model2; mtl: #mat2"></a-entity> -->
    <!-- <a-entity id="mol3" class="model" obj-model="obj: #model3; mtl: #mat3"></a-entity> -->


    <!-- try use simplified mesh -->

    <!-- <a-entity id="mol" class="model" obj-model="obj: #molcol; mtl: #matcol" position= "-0.5 1 1" collision-filter="group: red; collidesWith: default, red" dynamic-body="shape: hull; linearDamping: 0.99; angularDamping: 0.99" material="transparent: true; opacity: 0"></a-entity> -->

    <!-- <a-entity id="mol" class="model" obj-model="obj: #model2; mtl: #mat2" position= "-0.5 1 1" collision-filter="group: red; collidesWith: default, red" dynamic-body="shape: hull; linearDamping: 0.99; angularDamping: 0.99"></a-entity> -->


    <!-- Hull, Collada model -->
    <!-- Trying to use other object as collider! -->


    <!-- <a-entity id="daehull" class="model" collada-model="#hulldae" position="-0.5 1 1" collision-filter="group: red; collidesWith: default, red, green" stuck dynamic-body="shape: hull; linearDamping: 0.99; angularDamping: 0.99" follow="target: mol1"></a-entity> -->
    <!-- <a-entity id="mol1" class="complex" obj-model="obj: #model1; mtl: #mat1" position= "-0.5 1 1"></a-entity> -->

    <!-- <a-entity id="daehull2" class="model" collada-model="#hulldae2" position="0.5 1 1" collision-filter="group: red; collidesWith: default, red, green" stuck dynamic-body="shape: hull; linearDamping: 0.99; angularDamping: 0.99" follow="target: mol2"></a-entity> -->
    <!-- <a-entity id="mol2" class="complex" obj-model="obj: #model2; mtl: #mat2" position= "0.5 1 1"></a-entity> -->

    <!-- <a-entity class="model" id="blue" mixin="cube" material="color: blue" position="0 1 -1" constraint="target: #blue"></a-entity>
    <a-entity class="model" id="clear" mixin="cube" material="color: red; opacity: 0; transparent: true" position="0 1 1"></a-entity> -->


    <!-- Sticky Boxes! -->
    <!-- <a-entity class="model" id="red" mixin="cube" material="color: red" position="0 1 -1"></a-entity> -->
    <!-- <a-entity class="model" id="blue" mixin="cube" material="color: blue" position="0 1.6 -1"></a-entity> -->
    <!-- <a-entity class="model" id="green" mixin="cube" material="color: green" position="0 1 1" collision-filter="group: red; collidesWith: default, red"></a-entity> -->

    <!-- Sticky Molecules! -->
    <!-- <a-entity class="model" mixin="molecule" obj-model="obj: #model1; mtl: #mat1" position= "-0.5 1 1" collision-filter="group: blue; collidesWith: default"></a-entity> -->
    <!-- <a-entity class="model" mixin="molecule" obj-model="obj: #model2; mtl: #mat2" position="0.5 1 1" collision-filter="group: red; collidesWith: default, red"></a-entity> -->

    <!-- Box! -->
    <!-- <a-entity class="model" action geometry="primitive: box; depth: 0.2; height: 0.5; width: 1" material="color: red" position="-1 2 1" scale="1 1 1" dynamic-body></a-entity>
    <a-entity class="model" action geometry="primitive: box; depth: 0.2; height: 0.5; width: 1" material="color: blue" position="1 2 1" scale="1 1 1" dynamic-body></a-entity> -->

    <!-- two cartoons -->
    <!-- <a-entity class="model" obj-model="obj: #model1; mtl: #mat1" position= "-0.5 1 1" sleepy collision-filter="group: red; collidesWith: default, red, blue" dynamic-body></a-entity>
    <a-entity class="model" obj-model="obj: #model2; mtl: #mat2" position="0.5 1 1" sleepy collision-filter="group: red; collidesWith: default, red, blue" dynamic-body></a-entity> -->

    <!-- two surfaces -->
    <!-- <a-entity class="model" obj-model="obj: #model3; mtl: #mat3" position= "-0.5 1 3" dynamic-body="shape: box" sleepy collision-filter="group: red; collidesWith: default, red, blue"></a-entity>
    <a-entity class="model" obj-model="obj: #model4; mtl: #mat4" position="0.5 1 3" dynamic-body="shape: box" sleepy collision-filter="group: red; collidesWith: default, red, blue"></a-entity> -->

    <!-- Skybox (background) -->
    <a-sky src="../../static/img/skybox.jpg"></a-sky>

    <!-- <a-grid static-body collision-filter="group: default; collidesWith: red, green"></a-grid> -->
  </a-scene>

  </body>
</html>